"use strict";!function(e,t,o,n,a){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var i=t.getElementsByTagName(o)[0],c=t.createElement(o);c.async=!0,c.src="https://www.googletagmanager.com/gtm.js?id=GTM-T4PHTK3",i.parentNode.insertBefore(c,i)}(window,document,"script","dataLayer"),window.intercomSettings={app_id:"u8nmlvji"},function(){var e=window,t=e.Intercom;if("function"==typeof t)t("reattach_activator"),t("update",e.intercomSettings);else{var o=document,n=function e(){e.c(arguments)};n.q=[],n.c=function(e){n.q.push(e)},e.Intercom=n;var a=function(){var e=o.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://widget.intercom.io/widget/u8nmlvji";var t=o.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)};e.attachEvent?e.attachEvent("onload",a):e.addEventListener("load",a,!1)}}();var qs=new URLSearchParams(window.location.search),coAff=Cookies.get("affid"),qsAff=qs.get("affid"),qsCh=qs.get("ch"),affId=qsAff||window.channelConfig&&window.channelConfig.aff_id;(qsAff||qsCh)&&coAff!==affId&&Cookies.set("affid",affId,{expires:30});var loginInfo=window.localStorage.getItem("login"),crossDomainToken=Cookies.get("malus-token");if(loginInfo&&!crossDomainToken){var user=JSON.parse(loginInfo);user&&user.token&&Cookies.set("malus-token",user.token,{domain:".".concat(getRootDomain())})}function checkDownload(){var e=new URLSearchParams(window.location.search).get("dlu");if(e){var t=document.createElement("iframe");t.setAttribute("src",e),t.style.display="none",document.querySelector("body").appendChild(t),t.url=e}}crossDomainToken&&!loginInfo&&window.fetch("/api/getUserStatus",{method:"POST",headers:{"Content-Type":"application/json","x-malus-token":crossDomainToken},body:JSON.stringify({})}).then(function(e){return e.json()}).then(function(e){if(0===e.code){var t=e.data;window.localStorage.setItem("login",JSON.stringify(t)),t&&t.token&&(document.getElementById("guest-navbar").style.display="none",document.getElementById("login-navbar").style.display="flex")}}).catch(function(e){console.log("ERROR: ",e)});var query=new URLSearchParams(window.location.search);if(window.Cookies){var sourceUtm=Cookies.get("s_utm"),overwriteCh=!1,utm=null,channel=null;if(query.get("gclid")?(utm=channel="google/cpc",overwriteCh=!0):query.get("fbclid")?(utm=channel="facebook/cpc",overwriteCh=!0):query.get("ch")&&(channel=query.get("ch"),overwriteCh=!0),query.get("utm_source")){var qsMedium=query.get("utm_medium");utm=query.get("utm_source")+(qsMedium?"/"+query.get("utm_medium"):"")}utm&&Cookies.set("utm",utm),overwriteCh&&channel&&Cookies.set("ch",channel),!sourceUtm&&utm&&Cookies.set("s_utm",utm,{expires:30})}function doubleRedirect(){$(".double-redirect").click(function(){var e=$(this).data("href");window.location.href=e})}function addWechatSupport(){/MicroMessenger/gi.test(window.navigator.userAgent)&&($("body").addClass("wechat"),$("#intercom-contact").hide(),$("#chat-toast").hide(),window.Intercom("update",{hide_default_launcher:!0}))}function getRootDomain(){return window.location.host.split(".").slice(-2).join(".")}function autoToast(){var e={"Content-Type":"application/json"};crossDomainToken&&(e["x-malus-token"]=crossDomainToken),window.fetch("/api/getChatToast",{method:"POST",headers:e,body:JSON.stringify({pathname:window.location.pathname})}).then(function(e){return e.json()}).then(function(e){if(0===e.code&&e.data){var t=e.data,o=t.toast,n=t.modal;if(o){var a=o.delay?o.delay:1,i="toast-".concat(o.id),c=Cookies.get(i),r=o.interval?o.interval/60/24:1;if(c)return;Cookies.set(i,1,{expires:r}),setTimeout(function(){var e=document.createElement("div");e.classList="chat-toast show",e.innerHTML='\n            <div class="content">'.concat(o.content,'</div>\n            <div class="chat-btn-group">\n              <div class="chat-intercom btn">').concat(o.confirm&&o.confirm.btn,'</div>\n              <div class="chat-close btn">').concat(o.cancel&&o.cancel.btn,"</div>\n            </div>\n            "),document.querySelector("body").appendChild(e),$(".chat-intercom").click(function(){$(".chat-toast").remove(),window.Intercom&&window.Intercom("showNewMessage")}),$(".chat-close").click(function(){$(".chat-toast").remove()}),$("body")},1e3*a)}if(n&&n.img){var s=n.delay?n.delay:1,d="modal-".concat(n.id),l=Cookies.get(d),m=n.interval?n.interval/60/24:1;if(l)return;Cookies.set(d,1,{expires:m}),setTimeout(function(){var e=document.createElement("div");e.classList="malus-promotion-modal",e.innerHTML='\n            <div class="ml-promotion-modal-content">\n              <i id="promotion-modal-close" class="remixicon-close-circle-line"></i>\n              <a href="'.concat(n.img.link,'" class="51-banner">\n                ').concat(n.img.web?'<img class="web-banner" src="'.concat(n.img.web,'" alt="banner">'):'<img class="mobile-banner" src="'.concat(n.img.web,'" alt="mobile-banner">'),"\n              </a>\n            </div>\n          "),document.querySelector("body").appendChild(e),$("#promotion-modal-close").click(function(){$(".malus-promotion-modal").remove()})},1e3*s)}}}).catch(function(e){console.log("ERROR: ",e)})}query.get("token")&&(query.delete("token"),window.history.pushState(null,null,window.location.pathname+"?"+query.toString())),$(document).ready(function(){addWechatSupport(),checkDownload(),doubleRedirect(),window.feather.replace(),autoToast()});